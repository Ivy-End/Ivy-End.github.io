<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>线段树 – 无改动求解区间最值 – 忠诚 - 退思轩</title><meta name=theme-color><meta name=description content="昨天研究了一下线段树，发现原来线段树有这么多实现方式。当然，对于非递归自底向上线段树，俗称 ZKW 线段树还是不太理解。而且我的实现方式还是用的指针"><meta name=author content="Kai Wang"><link rel="preload stylesheet" as=style href=https://kwang.life/main.min.css><script defer src=https://kwang.life/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://kwang.life/theme.png><link rel=icon href=https://kwang.life/favicon.ico><link rel=apple-touch-icon href=https://kwang.life/apple-touch-icon.png><meta name=generator content="Hugo 0.100.2"><link rel=alternate type=text/plain href=https://kwang.life/2013/08/%E7%BA%BF%E6%AE%B5%E6%A0%91-%E6%97%A0%E6%94%B9%E5%8A%A8%E6%B1%82%E8%A7%A3%E5%8C%BA%E9%97%B4%E6%9C%80%E5%80%BC-%E5%BF%A0%E8%AF%9A/index.md title=退思轩><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-37961659-1','auto'),ga('send','pageview'))</script><meta itemprop=name content="线段树 – 无改动求解区间最值 – 忠诚"><meta itemprop=description content="昨天研究了一下线段树，发现原来线段树有这么多实现方式。当然，对于非递归自底向上线段树，俗称 ZKW 线段树还是不太理解。而且我的实现方式还是用的指针"><meta itemprop=datePublished content="2013-08-27T21:06:00+08:00"><meta itemprop=dateModified content="2013-08-27T21:06:00+08:00"><meta itemprop=wordCount content="1082"><meta itemprop=image content="https://kwang.life/images/favicons/logo.png"><meta itemprop=keywords content="线段树,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kwang.life/images/favicons/logo.png"><meta name=twitter:title content="线段树 – 无改动求解区间最值 – 忠诚"><meta name=twitter:description content="昨天研究了一下线段树，发现原来线段树有这么多实现方式。当然，对于非递归自底向上线段树，俗称 ZKW 线段树还是不太理解。而且我的实现方式还是用的指针"></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href=https://kwang.life>退思轩</a><div class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove('not-ready')},10);const btnMenu=document.querySelector('.btn-menu');btnMenu.addEventListener('click',()=>{htmlClass.toggle('open')});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg='#faf8f1'.replace(/"/g,''),setDark=e=>{metaTheme.setAttribute('content',e?'#000':lightBg),htmlClass[e?'add':'remove']('dark'),localStorage.setItem('dark',e)},darkScheme=window.matchMedia('(prefers-color-scheme: dark)');if(htmlClass.contains('dark'))setDark(!0);else{const e=localStorage.getItem('dark');setDark(e?e==='true':darkScheme.matches)}darkScheme.addEventListener('change',e=>{setDark(e.matches)});const btnDark=document.querySelector('.btn-dark');btnDark.addEventListener('click',()=>{setDark(localStorage.getItem('dark')!=='true')})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/posts/>所有文章</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/tags/>标签</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/categories/>分类</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/friends/>友链</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/about/>关于</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"><article><header class=mb-16><h1 class="!my-0 pb-2.5">线段树 – 无改动求解区间最值 – 忠诚</h1><div class="text-sm antialiased opacity-60"><time>Aug 27, 2013</time>
<span class=mx-1>&#183;</span>
<span>Kai Wang</span></div></header><section><p>昨天研究了一下线段树，发现原来线段树有这么多实现方式。当然，对于非递归自底向上线段树，俗称 ZKW 线段树还是不太理解。而且我的实现方式还是用的指针，所以效率不是特别高。首先记录一下自己对于线段树的理解吧。我们用忠诚这道题目来做例子。</p><p>线段树可以直观的表示为下面这张图：</p><figure><img src=/images/2013/%e7%ba%bf%e6%ae%b5%e6%a0%91%20%e2%80%93%20%e6%97%a0%e6%94%b9%e5%8a%a8%e6%b1%82%e8%a7%a3%e5%8c%ba%e9%97%b4%e6%9c%80%e5%80%bc%20%e2%80%93%20%e5%bf%a0%e8%af%9a/%e7%ba%bf%e6%ae%b5%e6%a0%91.jpg alt=线段树示意图><figcaption><p>线段树示意图</p></figcaption></figure><p>对于一个给定的区间，不断的二分，直到区间变为一个点为止。当然，平时我们所需要的线段树不是这么简陋的，我们需要一些数据域：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Node</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nLeft</span><span class=p>,</span> <span class=n>nRight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>nMoney</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Node</span> <span class=o>*</span><span class=n>pLeft</span><span class=p>,</span> <span class=o>*</span><span class=n>pRight</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>有了节点的数据结构，我们需要构建这棵树，我们使用递归的方式生成这棵树，当然，在生成的过程中也可以进行一些初始化操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>Node</span><span class=o>*</span> <span class=nf>Build</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Init data
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>l</span> <span class=o>==</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span> <span class=o>=</span> <span class=n>pMoney</span><span class=p>[</span><span class=n>l</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>=</span> <span class=n>l</span><span class=p>;</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span> <span class=o>=</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>l</span> <span class=o>==</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>pNode</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nMid</span> <span class=o>=</span> <span class=p>(</span><span class=n>l</span> <span class=o>+</span> <span class=n>r</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span> <span class=o>=</span> <span class=n>Build</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>nMid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span> <span class=o>=</span> <span class=n>Build</span><span class=p>(</span><span class=n>nMid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接下来就是线段树最核心的部分了，查找。查找的时候可能有三种情况：</p><ul><li>所需要查询的区间全部落在左儿子的区间中，递归左儿子。</li><li>所需要查询的区间全部落在右儿子的区间中，递归右儿子。</li><li>所需要查询的区间一部分在左儿子的区间中，另一部分在右儿子的区间中，递归左儿子，右儿子，根据需要进行一些操作，例如相加，取最大最小等。</li></ul><p>实现部分如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Query</span><span class=p>(</span><span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span><span class=p>,</span> <span class=kt>int</span> <span class=n>l</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>==</span> <span class=n>l</span> <span class=o>&amp;&amp;</span> <span class=n>r</span> <span class=o>==</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>&lt;=</span> <span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>+</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=k>return</span> <span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>r</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>l</span> <span class=o>&gt;</span> <span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>+</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=k>return</span> <span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>r</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nMid</span> <span class=o>=</span> <span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>+</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>min</span><span class=p>(</span><span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>nMid</span><span class=p>),</span> <span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span><span class=p>,</span> <span class=n>nMid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>r</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>但是上面的代码要递归很久才返回数据，有很多的重复运算，这样在数据量很大的情况下非常不理想，所以我们需要进行一些优化。我们可以考虑提前把每个区间的最值求出来，因为原来只有点区间才有数据：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Update</span><span class=p>(</span><span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>==</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=k>return</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span> <span class=o>=</span> <span class=n>min</span><span class=p>(</span><span class=n>Update</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span><span class=p>),</span> <span class=n>Update</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这样，这棵线段树的效率就得到了很大的提高。</p><p>附上忠诚代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=k>namespace</span> <span class=n>std</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Node</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nLeft</span><span class=p>,</span> <span class=n>nRight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>nMoney</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Node</span> <span class=o>*</span><span class=n>pLeft</span><span class=p>,</span> <span class=o>*</span><span class=n>pRight</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Node</span> <span class=o>*</span><span class=n>pRoot</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>N</span><span class=p>,</span> <span class=n>M</span><span class=p>,</span> <span class=n>nTmp</span><span class=p>,</span> <span class=n>L</span><span class=p>,</span> <span class=n>R</span><span class=p>,</span> <span class=n>ans</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>vector</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>pMoney</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Node</span><span class=o>*</span> <span class=nf>Build</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Update</span><span class=p>(</span><span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Query</span><span class=p>(</span><span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span><span class=p>,</span> <span class=kt>int</span> <span class=n>l</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ios</span><span class=o>::</span><span class=n>sync_with_stdio</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>N</span> <span class=o>&gt;&gt;</span> <span class=n>M</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>N</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>nTmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>pMoney</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=n>nTmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>pRoot</span> <span class=o>=</span> <span class=n>Build</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>N</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Update</span><span class=p>(</span><span class=n>pRoot</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>M</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>cin</span> <span class=o>&gt;&gt;</span> <span class=n>L</span> <span class=o>&gt;&gt;</span> <span class=n>R</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=n>ans</span> <span class=o>=</span> <span class=mi>2147483647</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>Query</span><span class=p>(</span><span class=n>pRoot</span><span class=p>,</span> <span class=n>L</span><span class=p>,</span> <span class=n>R</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Node</span><span class=o>*</span> <span class=nf>Build</span><span class=p>(</span><span class=kt>int</span> <span class=n>l</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Node</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>l</span> <span class=o>==</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span> <span class=o>=</span> <span class=n>pMoney</span><span class=p>[</span><span class=n>l</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>=</span> <span class=n>l</span><span class=p>;</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span> <span class=o>=</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>l</span> <span class=o>==</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>pNode</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>nMid</span> <span class=o>=</span> <span class=p>(</span><span class=n>l</span> <span class=o>+</span> <span class=n>r</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span> <span class=o>=</span> <span class=n>Build</span><span class=p>(</span><span class=n>l</span><span class=p>,</span> <span class=n>nMid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span> <span class=o>=</span> <span class=n>Build</span><span class=p>(</span><span class=n>nMid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Update</span><span class=p>(</span><span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>==</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=k>return</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span> <span class=o>=</span> <span class=n>min</span><span class=p>(</span><span class=n>Update</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span><span class=p>),</span> <span class=n>Update</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>Query</span><span class=p>(</span><span class=n>Node</span> <span class=o>*</span><span class=n>pNode</span><span class=p>,</span> <span class=kt>int</span> <span class=n>l</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>==</span> <span class=n>l</span> <span class=o>&amp;&amp;</span> <span class=n>r</span> <span class=o>==</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nMoney</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>&lt;=</span> <span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>+</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=k>return</span> <span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>r</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>l</span> <span class=o>&gt;</span> <span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>+</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span> <span class=k>return</span> <span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>r</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nMid</span> <span class=o>=</span> <span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nLeft</span> <span class=o>+</span> <span class=n>pNode</span><span class=o>-&gt;</span><span class=n>nRight</span><span class=p>)</span> <span class=o>/</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>min</span><span class=p>(</span><span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pLeft</span><span class=p>,</span> <span class=n>l</span><span class=p>,</span> <span class=n>nMid</span><span class=p>),</span> <span class=n>Query</span><span class=p>(</span><span class=n>pNode</span><span class=o>-&gt;</span><span class=n>pRight</span><span class=p>,</span> <span class=n>nMid</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>r</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class="mt-12 flex flex-wrap"><a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=https://kwang.life/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91>线段树</a></footer></article></main><footer class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://kwang.life>退思轩</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>✎ Paper</a></footer></body></html>