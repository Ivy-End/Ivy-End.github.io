<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>代码之美 | 退思轩</title><meta name=keywords content><meta name=description content="和光同尘，与时舒卷"><meta name=author content="Kai Wang"><link rel=canonical href=https://kwang.life/categories/%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E/><meta name=google-site-verification content="G-FVKQ0YJ3T3"><link crossorigin=anonymous href=/assets/css/stylesheet.ba84c199ea48667640579ceac83b3e66a29fe4698324e576ba664e21b78bbd91.css integrity="sha256-uoTBmepIZnZAV5zqyDs+ZqKf5GmDJOV2umZOIbeLvZE=" rel="preload stylesheet" as=style><link rel=icon href=https://kwang.life/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://kwang.life/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://kwang.life/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://kwang.life/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://kwang.life/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://kwang.life/categories/%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E/index.xml><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-FVKQ0YJ3T3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-FVKQ0YJ3T3',{anonymize_ip:!1})}</script><meta property="og:title" content="代码之美"><meta property="og:description" content="和光同尘，与时舒卷"><meta property="og:type" content="website"><meta property="og:url" content="https://kwang.life/categories/%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E/"><meta property="og:image" content="https://kwang.life/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="退思轩"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kwang.life/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="代码之美"><meta name=twitter:description content="和光同尘，与时舒卷"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://kwang.life accesskey=h title="退思轩 (Alt + H)"><img src=https://kwang.life/apple-touch-icon.png alt aria-label=logo height=35>退思轩</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kwang.life/categories/ title=categories><span>categories</span></a></li><li><a href=https://kwang.life/tags/ title=tags><span>tags</span></a></li><li><a href=https://example.org title=example.org><span>example.org</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://kwang.life>Home</a>&nbsp;»&nbsp;<a href=https://kwang.life/categories/>Categories</a></div><h1>代码之美
<a href=/categories/%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E/index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>2048 游戏制作过程（Java 描述）：第三节、创建界面</h2></header><div class=entry-content><p>首先，我们要使得我们的程序能够判断用户的手势，一共为上、下、左、右四种。在 GameView 类中添加如下代码：
private void initGameView() { setOnTouchListener(new View.OnTouchListener() { @Override public boolean onTouch(View v, MotionEvent event) { return false; } }); } 接下来，我们来分析一下如何进行手势判断。首先，用户的手势输入应该有两个数据，一个是按下的屏幕位置，一个是放开的屏幕位置。那么我们只需要计算横向和竖向坐标差的绝对值，绝对值较大的一个方向则是用户需求的方向。至于横向中的左右和竖向中的上下，我们可以通过按下和放开的位置的大小进行比较得出。
有了上面的分析，我们开始写代码：
private void initGameView() { setOnTouchListener(new View.OnTouchListener() { private float startX, startY; // 起始位置 private float endX, endY; // 终了位置 private float offsetX, offsetY; // 偏移量 @Override public boolean onTouch(View v, MotionEvent event) { switch(event.getAction()) { case MotionEvent.ACTION_DOWN: startX = event.getX(); startY = event.getY(); break; case MotionEvent....</p></div><footer class=entry-footer><span title='2015-05-14 20:03:00 +0800 +0800'>May 14, 2015</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;585 words&nbsp;·&nbsp;Kai Wang</footer><a class=entry-link aria-label="post link to 2048 游戏制作过程（Java 描述）：第三节、创建界面" href=https://kwang.life/posts/2015/2048-%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8Bjava-%E6%8F%8F%E8%BF%B0%E7%AC%AC%E4%B8%89%E8%8A%82%E5%88%9B%E5%BB%BA%E7%95%8C%E9%9D%A2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>2048 游戏制作过程（Java 描述）：第二节、基本设置</h2></header><div class=entry-content><p>首先，我们需要修改一下应用的图标。准备一个 png 格式的图标文件。如下图所示：
App 图标
接下来，找到上一节中保存项目的位置，依次展开文件夹中的 2048/Game2048/app/src/main/res 目录，如下图所示：
App 图标
分别将刚才制作完成的图标文件更改名字为 ic_launcher.png，并且修改尺寸为 144×144、96×96、72×72、48×48，分别放入 drawable-xxhdip、drawable-xhdpi、drawable-hdpi、drawble-mdpi 文件夹覆盖其中的图标文件。需要用到这么多尺寸的图片，是由于 Android 应用程序需要兼容不同的客户端而引起的。接下来我们打开 Genymotion，并且运行我们的应用，可以发现图标已经被修改：
App 图标
接下来，我们修改游戏显示的名称，我们希望只显示数字“2048”，切换到 Android Studio 界面，在左侧找到 values/strings.xml，双击打开该文件，将其中的 app_name 属性修改为 2048 即可，如下图所示：
&lt;?xml version="1.0" encoding="utf-8" ?> &lt;resources> &lt;string name="app_name">2048&lt;/string> &lt;string name="hello_world">Hello world!&lt;/string> &lt;string name="action_settings">Settings&lt;/string> &lt;/resources> 我们再次运行程序，即可发现应用名称已经被修改为“2048”，如下图所示：
App 名称
至此，我们已经完成了对该应用最基本的配置，接下来，我们需要创建最基本的游戏界面。
首先，打开 res/layout/activity_main.xml 文件，将右下角的 Design/Text 选项卡切换到 Text 界面，并且输入以下代码：
&lt;?xml version="1.0" encoding="utf-8"> &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="vertical" android:layout_width="match_parent" android:layout_height="match_parent"> &lt;LinearLayout android:layout_width="match_parent" android:layout_height="match_parent" android:orientation="horizontal"> &lt;TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Score" /> &lt;TextView android:id="@+id/tvScore" android:layout_width="wrap_content" android:layout_height="wrap_content" /> &lt;/LinearLayout> &lt;GridLayout android:id="@+id/gameView" android:layout_width="fill_parent" android:layout_height="0dp" android:layout_weight="1"> &lt;GridLayout> &lt;/LinearLayout> 我们看到在 andorid:text=“Score” 这段代码被深黄色包裹了起来，说明有一些修改建议，单击到上面，按下 Alt + Enter，在弹出的对话框中选择 Extract string resource，弹出下图的对话框，在 Resource Name 中输入 score，单击 OK，如下图所示：...</p></div><footer class=entry-footer><span title='2015-05-14 17:10:00 +0800 +0800'>May 14, 2015</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;227 words&nbsp;·&nbsp;Kai Wang</footer><a class=entry-link aria-label="post link to 2048 游戏制作过程（Java 描述）：第二节、基本设置" href=https://kwang.life/posts/2015/2048-%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8Bjava-%E6%8F%8F%E8%BF%B0%E7%AC%AC%E4%BA%8C%E8%8A%82%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>2048 游戏制作过程（Java 描述）：第一节、创建项目</h2></header><div class=entry-content><p>自从关于扫雷游戏制作过程的文章发布后，有同学让我写一些关于移动开发的文章，并且建议以雷电这款游戏为例。然而考虑到该项目对于初学者来说代码量较大，所以暂且不涉及这部分，转而使用较为简单的 2048 游戏作为例子，可能对于初学者来说更容易上手，并且也更容易自己动手实现出来。
本项目已根据文章进度托管在 GitHub 上：2048，读者可以自行查看。
由于没有 Mac，因此只能介绍关于 Android 平台相关的开发知识。然而进行 Android 开发之前，需要搭建 Android 开发环境，这一步比较有难度的，主要是各个软件的配置较为麻烦，使得很多初学者望而却步。目前主流的 IDE 有 Eclipse 以及 Android Studio，本文将以 Android Studio 作为集成开发环境，对 2048 游戏的开发过程进行详细的介绍。
然而 Android Studio 的配置并不如 Visual Studio 一样简单，下面将简单介绍一下 Android Studio 集成开发环境的部署，具体的细节步骤读者可以查阅相关资料。
安装 JDK，根据自己的操作系统选择合适的 JDK 版本，我们常用的是 Windows x64 版本； 安装 Andorid Studio； 启动 Android Studio，配置 Gradle，该部分较为繁琐，需要自行下载对应版本的 Gradle 包，读者可以参考相关资料； （可选）安装 Genymotion，也可以使用 Android Studio 默认的模拟器，但是速度较慢。 至此，假设读者已经配置完成了 Android 开发环境并且能够正常运行了。接下来，我们进行 2048 游戏项目的创建。首先打开 Android Studio，弹出如下图所示的界面：
Android Studio
单击 Start a new Android Studio project 创建一个新的 Android Studio 项目，弹出如下界面：...</p></div><footer class=entry-footer><span title='2015-05-08 21:42:00 +0800 +0800'>May 8, 2015</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;242 words&nbsp;·&nbsp;Kai Wang</footer><a class=entry-link aria-label="post link to 2048 游戏制作过程（Java 描述）：第一节、创建项目" href=https://kwang.life/posts/2015/2048-%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8Bjava-%E6%8F%8F%E8%BF%B0%E7%AC%AC%E4%B8%80%E8%8A%82%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>扫雷游戏制作过程（CSharp 描述）：第八节、整体完善</h2></header><div class=entry-content><p>这一节我们将介绍结束游戏的方法，以及一些整体方面的完善。首先考虑失败的情况，它会将所有的地雷都显示出来。我们新建一个 GameLost 函数：
private void GameLost() { for(int i = 1; i&lt;= nWidth; i++) { for(int j = 1; j&lt;= nHeight; j++) { if(pMine[i, j] == -1 && (pState[i, j] == 0 || pState[i, j] == 3)) // 未点开或者标记为问号的雷 { pState[i, j] = 1; // 点开该地雷 } } } } 在游戏结束的地方调用 GameLost 函数，因为我们上一节中讲述的游戏结束都是失败的情况：
if(nFlagCnt == nSysCnt || nFlagCnt + nDoubtCnt == nSysCnt) // 打开九宫格 { bool bFlag = OpenMine(MouseFocus.X, MouseFocus.Y); if(!...</p></div><footer class=entry-footer><span title='2015-05-02 11:12:00 +0800 +0800'>May 2, 2015</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;1004 words&nbsp;·&nbsp;Kai Wang</footer><a class=entry-link aria-label="post link to 扫雷游戏制作过程（CSharp 描述）：第八节、整体完善" href=https://kwang.life/posts/2015/%E6%89%AB%E9%9B%B7%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8Bcsharp-%E6%8F%8F%E8%BF%B0%E7%AC%AC%E5%85%AB%E8%8A%82%E6%95%B4%E4%BD%93%E5%AE%8C%E5%96%84/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>扫雷游戏制作过程（CSharp 描述）：第七节、内部实现（续）</h2></header><div class=entry-content><p>这一节我们主要讲解扫雷时鼠标单击的事件。我们首先介绍左键单击的事件，分为两种情况——遇到地雷，游戏结束；不是地雷，自动点开相邻的非地雷区域，并且显示对应地雷区域周围地雷的数目。
我们首先需要为 Form_Main 添加 MouseDown 以及 MouseUp 事件，分别用来监测鼠标按下以及弹起的事件信息。再定义两个全局变量，用来标识鼠标左键以及右键是否被按下，代码如下：
bool bMouseLeft; // 鼠标左键是否被按下 bool bMouseRight; // 鼠标右键是否被按下 在 MouseDown 事件中输入下面的代码：
private void Form_Main_MouseDown(object sender, MouseEventArgs e) { if(e.Button == MouseButtons.Left) // 鼠标左键被按下 { bMouseLeft = true; } if(e.Button == MouseButtons.Right) // 鼠标右键被按下 { bMouseRight = true; } } 在 MouseUp 事件中，我们需要获取鼠标弹起前按下的鼠标按键的状态信息，代码如下：
private void Form_Main_MouseUp(object sender, MouseEventArgs e) { if(bMouseLeft && BMouseRight) // 左右键同时按下 { } else if(bMouseLeft) // 左键被按下 { } else if(bMouseRight) // 右键被按下 { } } 我们首先处理鼠标左键按下的情况，这里分为两种情况，在前文中已经介绍过。但是在处理之前，我们需要获取游戏者单击的是哪个雷区，因此我们需要加入一些用以判断当前鼠标所属区域的代码。但是回顾一下，我们上一节中在 MouseMove 事件中已经获得了当前鼠标所属的区域，并且保存在了全局变量中，因此，我们直接调用即可：...</p></div><footer class=entry-footer><span title='2015-05-01 22:23:00 +0800 +0800'>May 1, 2015</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1532 words&nbsp;·&nbsp;Kai Wang</footer><a class=entry-link aria-label="post link to 扫雷游戏制作过程（CSharp 描述）：第七节、内部实现（续）" href=https://kwang.life/posts/2015/%E6%89%AB%E9%9B%B7%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8Bcsharp-%E6%8F%8F%E8%BF%B0%E7%AC%AC%E4%B8%83%E8%8A%82%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0%E7%BB%AD/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://kwang.life/categories/%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E/>«&nbsp;Prev&nbsp;</a>
<a class=next href=https://kwang.life/categories/%E4%BB%A3%E7%A0%81%E4%B9%8B%E7%BE%8E/page/3/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2023 <a href=https://kwang.life>退思轩</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>