<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>扫雷游戏制作过程（CSharp 描述）：第四节、菜单操作 - 退思轩</title><meta name=theme-color><meta name=description content="我们现在的程序单击菜单的时候不会有任何反应，这一节我们主要介绍菜单的相关代码，使得菜单能够正常使用。 在第二节中，我们曾经提出希望在对应级别（"><meta name=author content="Kai Wang"><link rel="preload stylesheet" as=style href=https://kwang.life/main.min.css><script defer src=https://kwang.life/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://kwang.life/theme.png><link rel=icon href=https://kwang.life/favicon.ico><link rel=apple-touch-icon href=https://kwang.life/apple-touch-icon.png><meta name=generator content="Hugo 0.100.2"><link rel=alternate type=text/plain href=https://kwang.life/2015/04/%E6%89%AB%E9%9B%B7%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E8%BF%87%E7%A8%8Bcsharp-%E6%8F%8F%E8%BF%B0%E7%AC%AC%E5%9B%9B%E8%8A%82%E8%8F%9C%E5%8D%95%E6%93%8D%E4%BD%9C/index.md title=退思轩><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-37961659-1','auto'),ga('send','pageview'))</script><meta itemprop=name content="扫雷游戏制作过程（CSharp 描述）：第四节、菜单操作"><meta itemprop=description content="我们现在的程序单击菜单的时候不会有任何反应，这一节我们主要介绍菜单的相关代码，使得菜单能够正常使用。 在第二节中，我们曾经提出希望在对应级别（"><meta itemprop=datePublished content="2015-04-22T16:33:00+08:00"><meta itemprop=dateModified content="2015-04-22T16:33:00+08:00"><meta itemprop=wordCount content="2649"><meta itemprop=image content="https://kwang.life/images/favicons/logo.png"><meta itemprop=keywords content="CSharp,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kwang.life/images/favicons/logo.png"><meta name=twitter:title content="扫雷游戏制作过程（CSharp 描述）：第四节、菜单操作"><meta name=twitter:description content="我们现在的程序单击菜单的时候不会有任何反应，这一节我们主要介绍菜单的相关代码，使得菜单能够正常使用。 在第二节中，我们曾经提出希望在对应级别（"></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href=https://kwang.life>退思轩</a><div class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove('not-ready')},10);const btnMenu=document.querySelector('.btn-menu');btnMenu.addEventListener('click',()=>{htmlClass.toggle('open')});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg='#faf8f1'.replace(/"/g,''),setDark=e=>{metaTheme.setAttribute('content',e?'#000':lightBg),htmlClass[e?'add':'remove']('dark'),localStorage.setItem('dark',e)},darkScheme=window.matchMedia('(prefers-color-scheme: dark)');if(htmlClass.contains('dark'))setDark(!0);else{const e=localStorage.getItem('dark');setDark(e?e==='true':darkScheme.matches)}darkScheme.addEventListener('change',e=>{setDark(e.matches)});const btnDark=document.querySelector('.btn-dark');btnDark.addEventListener('click',()=>{setDark(localStorage.getItem('dark')!=='true')})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/posts/>所有文章</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/tags/>标签</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/categories/>分类</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/friends/>友链</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/about/>关于</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"><article><header class=mb-16><h1 class="!my-0 pb-2.5">扫雷游戏制作过程（CSharp 描述）：第四节、菜单操作</h1><div class="text-sm antialiased opacity-60"><time>Apr 22, 2015</time>
<span class=mx-1>&#183;</span>
<span>Kai Wang</span></div></header><section><p>我们现在的程序单击菜单的时候不会有任何反应，这一节我们主要介绍菜单的相关代码，使得菜单能够正常使用。</p><p>在第二节中，我们曾经提出希望在对应级别（初级、中级、高级、自定义）的按钮的显示勾，以表示目前的游戏等级。我们有两个时候需要对它进行操作，一个是加载上次游戏设置的时候，一个是在游戏过程中进行设置的时候，我们先介绍第一种情况。按照下图修改代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// 选择对应的游戏等级</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>SelectLevel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>nWidth</span> <span class=p>==</span> <span class=m>10</span> <span class=p>&amp;&amp;</span> <span class=n>nHeight</span> <span class=p>==</span> <span class=m>10</span> <span class=p>&amp;&amp;</span> <span class=n>nMineCnt</span> <span class=p>==</span> <span class=m>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>beginnerBToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>intermediateIToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>expertEToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>settingSToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>nWidth</span> <span class=p>==</span> <span class=m>16</span> <span class=p>&amp;&amp;</span> <span class=n>nHeight</span> <span class=p>==</span> <span class=m>16</span> <span class=p>&amp;&amp;</span> <span class=n>nMineCnt</span> <span class=p>==</span> <span class=m>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>beginnerBToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>intermediateIToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>expertEToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>settingSToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>nWidth</span> <span class=p>==</span> <span class=m>30</span> <span class=p>&amp;&amp;</span> <span class=n>nHeight</span> <span class=p>==</span> <span class=m>16</span> <span class=p>&amp;&amp;</span> <span class=n>nMineCnt</span> <span class=p>==</span> <span class=m>99</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>beginnerBToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>intermediateIToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>expertEToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>settingSToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>beginnerBToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>intermediateIToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>expertEToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>settingSToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>注意到 beginnerBToolStripMenuItem、intermediateIToolStripMenuItem、expertEToolStripMenuItem、settingSToolStripMenuItem 分别表示四个等级的菜单的名称，通过修改它们的 Checked 属性来达到修改对应项目前面勾的状态。我们还需要在初始化函数中调用这个函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// 游戏参数设置</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;Width&#34;&gt;雷区宽度&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;Height&#34;&gt;雷区高度&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;MineCnt&#34;&gt;地雷数目&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>SetGame</span><span class=p>(</span><span class=kt>int</span> <span class=n>Width</span><span class=p>,</span> <span class=kt>int</span> <span class=n>Height</span><span class=p>,</span> <span class=kt>int</span> <span class=n>MineCnt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=n>Width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>nHeight</span> <span class=p>=</span> <span class=n>Height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>nMineCnt</span> <span class=p>=</span> <span class=n>MineCnt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>UpdateSize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这时候，我们运行就会发现Beginner菜单前面的勾被选中了：</p><figure><img src=/images/2015/%e6%89%ab%e9%9b%b7%e6%b8%b8%e6%88%8f%e5%88%b6%e4%bd%9c%e8%bf%87%e7%a8%8b%ef%bc%88CSharp%20%e6%8f%8f%e8%bf%b0%ef%bc%89%ef%bc%9a%e7%ac%ac%e5%9b%9b%e8%8a%82%e3%80%81%e8%8f%9c%e5%8d%95%e6%93%8d%e4%bd%9c/mineSweeper_4_03.png alt=菜单示意图><figcaption><p>菜单示意图</p></figcaption></figure><p>下面我们来处理一下各个菜单按钮的事件，我们只需要双击菜单上的按钮，程序会自动创建对应的单击事件，我们只需要在其中书写代码即可。我们首先来创建 Beginner、Intermediate、Expert、Exit、About 菜单项目对应的事件。我们先介绍 Beginner、Intermediate、Expert 菜单项目对应的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>beginnerBToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=m>10</span><span class=p>;</span> <span class=n>nHeight</span> <span class=p>=</span> <span class=m>10</span><span class=p>;</span> <span class=n>nMineCnt</span> <span class=p>=</span> <span class=m>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>intermediateIToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=m>16</span><span class=p>;</span> <span class=n>nHeight</span> <span class=p>=</span> <span class=m>16</span><span class=p>;</span> <span class=n>nMineCnt</span> <span class=p>=</span> <span class=m>40</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>expertEToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=m>30</span><span class=p>;</span> <span class=n>nHeight</span> <span class=p>=</span> <span class=m>16</span><span class=p>;</span> <span class=n>nMineCnt</span> <span class=p>=</span> <span class=m>99</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>接下来，我们处理 Exit 事件，我们希望在退出游戏之前询问游戏者是否确认退出，代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>exitXToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>MessageBox</span><span class=p>.</span><span class=n>Show</span><span class=p>(</span><span class=s>&#34;Are you sure to exit the game?&#34;</span><span class=p>,</span> <span class=s>&#34;Exit&#34;</span><span class=p>,</span> <span class=n>MessageBoxButtons</span><span class=p>.</span><span class=n>YesNo</span><span class=p>,</span> <span class=n>MessageBoxIcon</span><span class=p>.</span><span class=n>Question</span><span class=p>)</span> <span class=p>==</span> <span class=n>DialogResult</span><span class=p>.</span><span class=n>Yes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>Application</span><span class=p>.</span><span class=n>Exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>然后，我们来处理 About 事件，我们希望得到类似 Windows 默认关于窗口的界面。为此，首先我们需要引用一个类，在代码的开头部分加上下图高亮部分的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>System</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Collections.Generic</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.ComponentModal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Drawing</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Linq</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Runtime.InteropServices</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Text</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Threading.Tasks</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>System.Windows.Forms</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>为了实现这样的功能，我们需要调用 Windows 系统内部的一个 API，添加这样一个函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// 系统关于对话框（API）</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;hWnd&#34;&gt;窗口句柄&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;szApp&#34;&gt;标题文本&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;szOtherStuff&#34;&gt;内容文本&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;param name=&#34;hIcon&#34;&gt;图标句柄&lt;/param&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;returns&gt;&lt;/returns&gt;</span>
</span></span><span class=line><span class=cl><span class=na>        [DllImport(&#34;shell32.dll&#34;)]</span>
</span></span><span class=line><span class=cl>        <span class=k>public</span> <span class=k>extern</span> <span class=k>static</span> <span class=kt>int</span> <span class=n>ShellAbout</span><span class=p>(</span><span class=n>IntPtr</span> <span class=n>hWnd</span><span class=p>,</span> <span class=kt>string</span> <span class=n>szApp</span><span class=p>,</span> <span class=kt>string</span> <span class=n>szOtherStuff</span><span class=p>,</span> <span class=n>IntPtr</span> <span class=n>hIcon</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>在 About 事件中添加如下代码进行调用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>aboutAToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>ShellAbout</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=n>Handle</span><span class=p>,</span> <span class=s>&#34;Minesweeper&#34;</span><span class=p>,</span> <span class=s>&#34;A minesweeper game using CSharp language.&#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>Icon</span><span class=p>.</span><span class=n>Handle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>运行以后查看结果如下图所示：</p><figure><img src=/images/2015/%e6%89%ab%e9%9b%b7%e6%b8%b8%e6%88%8f%e5%88%b6%e4%bd%9c%e8%bf%87%e7%a8%8b%ef%bc%88CSharp%20%e6%8f%8f%e8%bf%b0%ef%bc%89%ef%bc%9a%e7%ac%ac%e5%9b%9b%e8%8a%82%e3%80%81%e8%8f%9c%e5%8d%95%e6%93%8d%e4%bd%9c/mineSweeper_4_09.png alt=关于><figcaption><p>关于</p></figcaption></figure><p>可能细心的读者会发现，虽然我们通过菜单修改了游戏等级，但是我们窗口中的雷区却没有发生变化，因为我们没有在菜单被按下的时候没有调用 UpdateSize 函数。在三个按钮的事件中添加对 UpdateSize 函数的调用即可。代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>beginnerBToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=m>10</span><span class=p>;</span> <span class=n>nHeight</span> <span class=p>=</span> <span class=m>10</span><span class=p>;</span> <span class=n>nMineCnt</span> <span class=p>=</span> <span class=m>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>UpdateSize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>intermediateIToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=m>16</span><span class=p>;</span> <span class=n>nHeight</span> <span class=p>=</span> <span class=m>16</span><span class=p>;</span> <span class=n>nMineCnt</span> <span class=p>=</span> <span class=m>40</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>UpdateSize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>expertEToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=m>30</span><span class=p>;</span> <span class=n>nHeight</span> <span class=p>=</span> <span class=m>16</span><span class=p>;</span> <span class=n>nMineCnt</span> <span class=p>=</span> <span class=m>99</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>UpdateSize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在此运行的时候，我们发现修改游戏等级的时候，游戏界面也会发生相应的变化。但是还有一点瑕疵，就是在大规模变成小规模的时候，边上会有多余的雷区。为了修正这个 Bug，我们需要将原来 Paint 事件中代码放在一个新的函数 PaintGame 中，同时添加高亮区域的代码，并且在 Paint 事件中进行调用，代码如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>Form_Main_Paint</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>PaintEventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>PaintGame</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// 绘制游戏区</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;/summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>PaintGame</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Graphics</span> <span class=n>g</span> <span class=p>=</span> <span class=k>this</span><span class=p>.</span><span class=n>CreateGraphics</span><span class=p>();</span>     <span class=c1>// 创建绘图句柄</span>
</span></span><span class=line><span class=cl>            <span class=n>g</span><span class=p>.</span><span class=n>FillRectangle</span><span class=p>(</span><span class=n>Brushes</span><span class=p>.</span><span class=n>White</span><span class=p>,</span> <span class=k>new</span> <span class=n>Rectangle</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>Width</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=n>Height</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 我们需要使雷区在用户显示的区域上下左右保持 6px 的偏移量，使得整体看起来更加协调</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nOffsetX</span> <span class=p>=</span> <span class=m>6</span><span class=p>;</span>   <span class=c1>// X 方向偏移量</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nOffsetY</span> <span class=p>=</span> <span class=m>6</span> <span class=p>+</span> <span class=n>MenuStrip_Main</span><span class=p>.</span><span class=n>Height</span><span class=p>;</span>   <span class=c1>// Y 方向偏移量</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>1</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;=</span> <span class=n>nWidth</span><span class=p>;</span> <span class=n>i</span><span class=p>++)</span>   <span class=c1>// 绘制行</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=p>=</span> <span class=m>1</span><span class=p>;</span> <span class=n>j</span> <span class=p>&lt;=</span> <span class=n>nHeight</span><span class=p>;</span> <span class=n>j</span><span class=p>++)</span>  <span class=c1>// 绘制列</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 第一个参数为笔刷，这里采用内置笔刷 SandyBrown</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 第二个参数为方块的参数，这里采用左上角坐标以及长宽的形式给出</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 34 表示每个雷区的大小，再加上偏移量就是我们当前雷区的起始位置，由于要空出 1px 的间隔，因此还需要加 1</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 由此可以得到每个方块在雷区中的位置，然后利用循环绘制出来</span>
</span></span><span class=line><span class=cl>                    <span class=n>g</span><span class=p>.</span><span class=n>FillRectangle</span><span class=p>(</span><span class=n>Brushes</span><span class=p>.</span><span class=n>SandyBrown</span><span class=p>,</span> <span class=k>new</span> <span class=n>Rectangle</span><span class=p>(</span><span class=n>nOffsetX</span> <span class=p>+</span> <span class=m>34</span> <span class=p>*</span> <span class=p>(</span><span class=n>i</span> <span class=p>-</span> <span class=m>1</span><span class=p>)</span> <span class=p>+</span> <span class=m>1</span><span class=p>,</span> <span class=n>nOffsetY</span> <span class=p>+</span> <span class=m>34</span> <span class=p>*</span> <span class=p>(</span><span class=n>j</span> <span class=p>-</span> <span class=m>1</span><span class=p>)</span> <span class=p>+</span> <span class=m>1</span><span class=p>,</span> <span class=m>32</span><span class=p>,</span> <span class=m>32</span><span class=p>));</span>   <span class=c1>// 绘制雷区方块</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>除此之外，在UpdateSize最后也需要调用PaintGame函数，如下图所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// 自动更新窗口大小</span>
</span></span><span class=line><span class=cl>        <span class=cs>/// &lt;summary&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>UpdateSize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nOffsetX</span> <span class=p>=</span> <span class=k>this</span><span class=p>.</span><span class=n>Width</span> <span class=p>-</span> <span class=k>this</span><span class=p>.</span><span class=n>ClientSize</span><span class=p>.</span><span class=n>Width</span><span class=p>;</span>  <span class=c1>// 包含了窗口标题栏以及上下边框的高度</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nOffsetY</span> <span class=p>=</span> <span class=k>this</span><span class=p>.</span><span class=n>Height</span> <span class=p>-</span> <span class=k>this</span><span class=p>.</span><span class=n>ClientSize</span><span class=p>.</span><span class=n>Height</span><span class=p>;</span>    <span class=c1>// 包含了左右边框的宽度</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>nAdditionY</span> <span class=p>=</span> <span class=n>MenuStrip_Main</span><span class=p>.</span><span class=n>Height</span> <span class=p>+</span> <span class=n>TableLayoutPanel_Main</span><span class=p>.</span><span class=n>Height</span><span class=p>;</span>  <span class=c1>// 包含了菜单栏以及下方显示信息栏的高度</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=n>Width</span> <span class=p>=</span> <span class=m>12</span> <span class=p>+</span> <span class=m>34</span> <span class=p>*</span> <span class=n>nWidth</span> <span class=p>+</span> <span class=n>nOffsetX</span><span class=p>;</span>   <span class=c1>// 设置窗口高度，34 为每个雷区的高度，12 为上下总空隙（6px + 6px），再加上偏移量</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=n>Height</span> <span class=p>=</span> <span class=m>12</span> <span class=p>+</span> <span class=m>34</span> <span class=p>*</span> <span class=n>nHeight</span> <span class=p>+</span> <span class=n>nAdditionY</span> <span class=p>+</span> <span class=n>nOffsetY</span><span class=p>;</span>    <span class=c1>// 设置窗口宽度，同理</span>
</span></span><span class=line><span class=cl>            <span class=n>PaintGame</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>再次运行的时候，就会发现边上多余的雷区已经消失了。</p><p>接下来我们处理 Mark 以及 Audio 两个事件，我们需要定义两个变量来记录它们的数据，因为这对于我们以后的开发有很大的关系。如下图所示：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>namespace</span> <span class=nn>Minesweeper</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>partial</span> <span class=k>class</span> <span class=nc>Form_Main</span> <span class=p>:</span> <span class=n>Form</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>nWidth</span><span class=p>;</span>     <span class=c1>// 表示雷区的宽度</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>nHeight</span><span class=p>;</span>    <span class=c1>// 表示雷区的高度</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>nMineCnt</span><span class=p>;</span>   <span class=c1>// 表示地雷的数目</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=n>bMark</span><span class=p>;</span>     <span class=c1>// 表示是否使用标记</span>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=n>bAudio</span><span class=p>;</span>    <span class=c1>// 表示是否使用音效</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>同样我们需要在游戏开始的时候读取上次的数据，如果没有则都设置为真。我们首先看 Setting 文件：</p><figure><img src=/images/2015/%e6%89%ab%e9%9b%b7%e6%b8%b8%e6%88%8f%e5%88%b6%e4%bd%9c%e8%bf%87%e7%a8%8b%ef%bc%88CSharp%20%e6%8f%8f%e8%bf%b0%ef%bc%89%ef%bc%9a%e7%ac%ac%e5%9b%9b%e8%8a%82%e3%80%81%e8%8f%9c%e5%8d%95%e6%93%8d%e4%bd%9c/mineSweeper_4_14.png alt="Setting 文件配置"><figcaption><p>Setting 文件配置</p></figcaption></figure><p>同时加入以下代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>public</span> <span class=n>Form_Main</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>InitializeComponent</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 初始化游戏参数</span>
</span></span><span class=line><span class=cl>            <span class=n>nWidth</span> <span class=p>=</span> <span class=n>Properties</span><span class=p>.</span><span class=n>Settings</span><span class=p>.</span><span class=n>Default</span><span class=p>.</span><span class=n>Width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>nHeight</span> <span class=p>=</span> <span class=n>Properties</span><span class=p>.</span><span class=n>Settings</span><span class=p>.</span><span class=n>Default</span><span class=p>.</span><span class=n>Height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>nMineCnt</span> <span class=p>=</span> <span class=n>Properties</span><span class=p>.</span><span class=n>Settings</span><span class=p>.</span><span class=n>Default</span><span class=p>.</span><span class=n>MineCnt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 初始化</span>
</span></span><span class=line><span class=cl>            <span class=n>bMark</span> <span class=p>=</span> <span class=n>Properties</span><span class=p>.</span><span class=n>Settings</span><span class=p>.</span><span class=n>Default</span><span class=p>.</span><span class=n>Mark</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>bAudio</span> <span class=p>=</span> <span class=n>Properties</span><span class=p>.</span><span class=n>Settings</span><span class=p>.</span><span class=n>Default</span><span class=p>.</span><span class=n>Audio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>markMToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=n>bMark</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>audioMToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=n>bAudio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>UpdateSize</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>SelectLevel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>同时为 Mark 以及 Audio 菜单项目添加如下的事件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>markMToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>markMToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=n>bMark</span> <span class=p>=</span> <span class=p>!</span><span class=n>bMark</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>private</span> <span class=k>void</span> <span class=n>audioMToolStripMenuItem_Click</span><span class=p>(</span><span class=kt>object</span> <span class=n>sender</span><span class=p>,</span> <span class=n>EventArgs</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>audioMToolStripMenuItem</span><span class=p>.</span><span class=n>Checked</span> <span class=p>=</span> <span class=n>bAudio</span> <span class=p>=</span> <span class=p>!</span><span class=n>bAudio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>至此，我们还剩 New Game、Setting、Rank 三个菜单选项的事件没有涉及，因为它们需用用到更多的内容，我们将会在下一节中进行讲解。</p></section><footer class="mt-12 flex flex-wrap"><a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=https://kwang.life/tags/csharp>CSharp</a></footer></article></main><footer class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=https://kwang.life>退思轩</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>✎ Paper</a></footer></body></html>